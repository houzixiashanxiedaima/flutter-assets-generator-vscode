# å¼€å‘æŒ‡å—

æœ¬æ–‡æ¡£æä¾›é¡¹ç›®çš„å¼€å‘æŒ‡å—å’Œæœ€ä½³å®è·µã€‚

## ğŸ“‹ å¼€å‘æµç¨‹

### 1. éœ€æ±‚è¯„å®¡é˜¶æ®µ (å½“å‰)

**ä»»åŠ¡æ¸…å•**:
- [x] é˜…è¯» PRD æ–‡æ¡£ (`docs/PRD.md`)
- [x] é˜…è¯» PRD è¯„å®¡æŠ¥å‘Š (`docs/PRD_REVIEW.md`)
- [ ] ç¡®è®¤æ ¸å¿ƒåŠŸèƒ½èŒƒå›´
- [ ] ç¡®è®¤æŠ€æœ¯æ–¹æ¡ˆ
- [ ] ç¡®è®¤é…ç½®å±‚çº§è®¾è®¡
- [ ] æ›´æ–° PRD æ–‡æ¡£ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰

**å…³é”®å†³ç­–ç‚¹**:
1. æ˜¯å¦æ”¯æŒ `snake_case` å’Œ `PascalCase` å‘½åé£æ ¼ï¼Ÿ
2. æ˜¯å¦å®ç° `.vscode/settings.json` é…ç½®è¦†ç›–åŠŸèƒ½ï¼Ÿ
3. é…ç½®å±‚çº§å¦‚ä½•è®¾è®¡ï¼ˆ2 å±‚ vs 3 å±‚ï¼‰ï¼Ÿ

### 2. è®¾è®¡é˜¶æ®µ

**ä»»åŠ¡æ¸…å•**:
- [ ] è®¾è®¡ç›®å½•ç»“æ„
- [ ] è®¾è®¡ç±»å’Œæ¥å£
- [ ] è®¾è®¡é…ç½®è¯»å–é€»è¾‘
- [ ] è®¾è®¡æ–‡ä»¶ç›‘å¬æœºåˆ¶
- [ ] ç¼–å†™æŠ€æœ¯è®¾è®¡æ–‡æ¡£

### 3. å®ç°é˜¶æ®µ

**Phase 1 - MVP (æœ€å°å¯è¡Œäº§å“)**:
- [ ] pubspec.yaml è§£æ
- [ ] èµ„æºæ–‡ä»¶æ‰«æ
- [ ] camelCase å‘½åè½¬æ¢
- [ ] ä»£ç ç”Ÿæˆ
- [ ] å‘½ä»¤é¢æ¿è§¦å‘

**Phase 2 - æ ¸å¿ƒåŠŸèƒ½**:
- [ ] æ–‡ä»¶ç›‘å¬ (chokidar)
- [ ] é…ç½®è¯»å–ï¼ˆå…¨å±€ + é¡¹ç›®ï¼‰
- [ ] çˆ¶ç›®å½•å‘½åæ”¯æŒ
- [ ] é‡å¤å‘½åå¤„ç†
- [ ] è‡ªåŠ¨åˆ›å»ºè¾“å‡ºç›®å½•

**Phase 3 - å¢å¼ºåŠŸèƒ½**:
- [ ] CodeLens é¢„è§ˆ
- [ ] å³é”®èœå•æ·»åŠ è·¯å¾„
- [ ] å¤šæ ¹å·¥ä½œåŒºæ”¯æŒ
- [ ] é€šçŸ¥å’Œé”™è¯¯å¤„ç†

**Phase 4 - é«˜çº§åŠŸèƒ½**:
- [ ] å¤šç§å‘½åé£æ ¼ï¼ˆå¦‚æœç¡®è®¤ï¼‰
- [ ] å¯è§†åŒ–é…ç½®ç•Œé¢
- [ ] å®æ—¶é¢„è§ˆ

### 4. æµ‹è¯•é˜¶æ®µ

**å•å…ƒæµ‹è¯•**:
- [ ] å‘½åè½¬æ¢å‡½æ•°
- [ ] é…ç½®è§£æé€»è¾‘
- [ ] æ–‡ä»¶è¿‡æ»¤è§„åˆ™
- [ ] ä»£ç ç”Ÿæˆé€»è¾‘

**é›†æˆæµ‹è¯•**:
- [ ] å®Œæ•´ç”Ÿæˆæµç¨‹
- [ ] æ–‡ä»¶ç›‘å¬åŠŸèƒ½
- [ ] å¤šé¡¹ç›®æ”¯æŒ

**æ‰‹åŠ¨æµ‹è¯•**:
- [ ] åœ¨çœŸå® Flutter é¡¹ç›®ä¸­æµ‹è¯•
- [ ] æµ‹è¯•è¾¹ç•Œæƒ…å†µ
- [ ] æ€§èƒ½æµ‹è¯•

### 5. å‘å¸ƒé˜¶æ®µ

- [ ] ç¼–å†™ç”¨æˆ·æ–‡æ¡£
- [ ] å½•åˆ¶æ¼”ç¤ºè§†é¢‘
- [ ] å‘å¸ƒåˆ° VSCode Marketplace

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ extension.ts              # æ‰©å±•å…¥å£ï¼Œæ³¨å†Œå‘½ä»¤å’Œäº‹ä»¶
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ generator.ts          # ä»£ç ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ scanner.ts            # èµ„æºæ‰«æå™¨
â”‚   â””â”€â”€ naming.ts             # å‘½åè½¬æ¢å·¥å…·
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ reader.ts             # é…ç½®è¯»å–
â”‚   â”œâ”€â”€ types.ts              # é…ç½®ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ validator.ts          # é…ç½®éªŒè¯
â”œâ”€â”€ parser/
â”‚   â”œâ”€â”€ pubspec.ts            # pubspec.yaml è§£æ
â”‚   â””â”€â”€ yaml-utils.ts         # YAML å·¥å…·å‡½æ•°
â”œâ”€â”€ watcher/
â”‚   â”œâ”€â”€ file-watcher.ts       # æ–‡ä»¶ç›‘å¬
â”‚   â””â”€â”€ debounce.ts           # é˜²æŠ–å·¥å…·
â”œâ”€â”€ providers/
â”‚   â”œâ”€â”€ code-lens.ts          # CodeLens æä¾›è€…
â”‚   â””â”€â”€ preview.ts            # é¢„è§ˆé€»è¾‘
â”œâ”€â”€ commands/
â”‚   â”œâ”€â”€ generate.ts           # ç”Ÿæˆå‘½ä»¤
â”‚   â”œâ”€â”€ add-to-assets.ts      # æ·»åŠ åˆ° pubspec å‘½ä»¤
â”‚   â””â”€â”€ open-settings.ts      # æ‰“å¼€è®¾ç½®å‘½ä»¤
â””â”€â”€ utils/
    â”œâ”€â”€ file-utils.ts         # æ–‡ä»¶æ“ä½œå·¥å…·
    â”œâ”€â”€ path-utils.ts         # è·¯å¾„å¤„ç†å·¥å…·
    â””â”€â”€ logger.ts             # æ—¥å¿—å·¥å…·
```

### æ ¸å¿ƒç±»è®¾è®¡

```typescript
// config/types.ts
export interface AssetConfig {
  outputDir: string;
  outputFilename: string;
  className: string;
  namingStyle: 'camelCase' | 'snake_case' | 'PascalCase';
  namedWithParent: boolean;
  filenameSplitPattern: string;
  leadingWithPackageName: boolean;
  pathIgnore: string[];
  autoDetection: boolean;
}

// core/scanner.ts
export class AssetScanner {
  scan(paths: string[], config: AssetConfig): Map<string, string>;
  shouldIgnore(path: string, config: AssetConfig): boolean;
}

// core/naming.ts
export class NamingConverter {
  toCamelCase(filename: string, pattern: RegExp): string;
  toSnakeCase(filename: string, pattern: RegExp): string;
  toPascalCase(filename: string, pattern: RegExp): string;
  withParent(name: string, parent: string, pattern: RegExp): string;
}

// core/generator.ts
export class CodeGenerator {
  generate(assets: Map<string, string>, config: AssetConfig): string;
  resolveConflicts(assets: Map<string, string>): Map<string, string>;
}

// parser/pubspec.ts
export class PubspecParser {
  parse(content: string): PubspecData;
  getAssetPaths(): string[];
  getConfig(): AssetConfig;
  addAssetPath(path: string): void;
}
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•ç¤ºä¾‹

```typescript
// tests/naming.test.ts
import { NamingConverter } from '../src/core/naming';

describe('NamingConverter', () => {
  const converter = new NamingConverter();
  const pattern = /[-_]/;

  describe('toCamelCase', () => {
    test('converts snake_case to camelCase', () => {
      expect(converter.toCamelCase('home_icon', pattern)).toBe('homeIcon');
    });

    test('converts kebab-case to camelCase', () => {
      expect(converter.toCamelCase('home-icon', pattern)).toBe('homeIcon');
    });

    test('handles dots in filename', () => {
      expect(converter.toCamelCase('icon.v2', pattern)).toBe('iconV2');
    });

    test('handles @ symbol', () => {
      expect(converter.toCamelCase('icon@2x', pattern)).toBe('icon2x');
    });
  });

  describe('withParent', () => {
    test('adds parent directory name', () => {
      const result = converter.withParent('homeIcon', 'images', pattern);
      expect(result).toBe('imagesHomeIcon');
    });
  });
});
```

### é›†æˆæµ‹è¯•ç¤ºä¾‹

```typescript
// tests/integration/generate.test.ts
import * as vscode from 'vscode';
import * as path from 'path';
import * as fs from 'fs';

describe('Generate Assets Integration', () => {
  test('generates assets file for Flutter project', async () => {
    // 1. åˆ›å»ºä¸´æ—¶å·¥ä½œåŒº
    const workspaceFolder = createTempWorkspace();

    // 2. åˆ›å»º pubspec.yaml
    const pubspecContent = `
name: test_app
flutter:
  assets:
    - assets/images/
`;
    fs.writeFileSync(
      path.join(workspaceFolder, 'pubspec.yaml'),
      pubspecContent
    );

    // 3. åˆ›å»ºèµ„æºæ–‡ä»¶
    const assetsDir = path.join(workspaceFolder, 'assets', 'images');
    fs.mkdirSync(assetsDir, { recursive: true });
    fs.writeFileSync(path.join(assetsDir, 'home_icon.png'), '');

    // 4. è§¦å‘ç”Ÿæˆå‘½ä»¤
    await vscode.commands.executeCommand('flutter-assets-generator.generate');

    // 5. éªŒè¯ç”Ÿæˆçš„æ–‡ä»¶
    const outputPath = path.join(
      workspaceFolder,
      'lib',
      'generated',
      'assets.dart'
    );
    expect(fs.existsSync(outputPath)).toBe(true);

    const content = fs.readFileSync(outputPath, 'utf-8');
    expect(content).toContain('class Assets');
    expect(content).toContain('imagesHomeIcon');
    expect(content).toContain('assets/images/home_icon.png');

    // 6. æ¸…ç†
    cleanupTempWorkspace(workspaceFolder);
  });
});
```

---

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—

```typescript
// src/utils/logger.ts
export class Logger {
  private outputChannel: vscode.OutputChannel;

  constructor() {
    this.outputChannel = vscode.window.createOutputChannel('Flutter Assets Generator');
  }

  info(message: string) {
    this.outputChannel.appendLine(`[INFO] ${message}`);
  }

  debug(message: string) {
    if (process.env.DEBUG) {
      this.outputChannel.appendLine(`[DEBUG] ${message}`);
    }
  }

  error(message: string, error?: Error) {
    this.outputChannel.appendLine(`[ERROR] ${message}`);
    if (error) {
      this.outputChannel.appendLine(error.stack || error.message);
    }
    this.outputChannel.show();
  }
}
```

### 2. ä½¿ç”¨ VSCode è°ƒè¯•å™¨

åœ¨ `.vscode/launch.json` ä¸­å·²é…ç½®å¥½è°ƒè¯•ç¯å¢ƒï¼š
- æŒ‰ `F5` å¯åŠ¨æ‰©å±•å®¿ä¸»
- åœ¨ä»£ç ä¸­è®¾ç½®æ–­ç‚¹
- åœ¨æ‰©å±•å®¿ä¸»çª—å£ä¸­è§¦å‘åŠŸèƒ½

### 3. æŸ¥çœ‹ OUTPUT é¢æ¿

è¿è¡Œæ—¶å¯åœ¨ VSCode çš„ OUTPUT é¢æ¿é€‰æ‹© "Flutter Assets Generator" æŸ¥çœ‹æ—¥å¿—ã€‚

---

## ğŸ“¦ ä¾èµ–ç®¡ç†

### æ ¸å¿ƒä¾èµ–

```json
{
  "js-yaml": "^4.1.0",      // YAML è§£æ
  "chokidar": "^3.5.3"      // æ–‡ä»¶ç›‘å¬
}
```

### ä¸ºä»€ä¹ˆé€‰æ‹©è¿™äº›åº“ï¼Ÿ

**js-yaml**:
- æœ€æµè¡Œçš„ YAML è§£æåº“
- æ”¯æŒ YAML 1.2 è§„èŒƒ
- å¯é ä¸”ç»´æŠ¤è‰¯å¥½

**chokidar**:
- è·¨å¹³å°æ–‡ä»¶ç›‘å¬åº“
- æ€§èƒ½ä¼˜ç§€ï¼Œæ”¯æŒå¤§é‡æ–‡ä»¶
- åŸ Android Studio æ’ä»¶ä¹Ÿä½¿ç”¨ç±»ä¼¼æœºåˆ¶

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. æ–‡ä»¶æ‰«æä¼˜åŒ–

```typescript
// ä½¿ç”¨ glob æ¨¡å¼å¿«é€ŸåŒ¹é…
import { glob } from 'glob';

async function scanAssets(paths: string[]): Promise<string[]> {
  const patterns = paths.map(p => `${p}**/*`);
  return await glob(patterns, {
    ignore: ['**/.*', '**/2.0x/**', '**/3.0x/**'],  // æ’é™¤éšè—æ–‡ä»¶å’Œå¯†åº¦å˜ä½“
    nodir: true  // åªè¿”å›æ–‡ä»¶
  });
}
```

### 2. é˜²æŠ–ä¼˜åŒ–

```typescript
// ä½¿ç”¨é˜²æŠ–é¿å…é¢‘ç¹é‡æ–°ç”Ÿæˆ
import { debounce } from 'lodash';

class AssetWatcher {
  private generateDebounced = debounce(() => {
    this.generate();
  }, 300);  // 300ms é˜²æŠ–ï¼Œä¸åŸæ’ä»¶ä¸€è‡´

  onFileChange() {
    this.generateDebounced();
  }
}
```

### 3. ç¼“å­˜ä¼˜åŒ–

```typescript
// ç¼“å­˜é…ç½®è¯»å–ç»“æœ
class ConfigCache {
  private cache = new Map<string, AssetConfig>();

  get(pubspecPath: string): AssetConfig | undefined {
    return this.cache.get(pubspecPath);
  }

  set(pubspecPath: string, config: AssetConfig) {
    this.cache.set(pubspecPath, config);
  }

  invalidate(pubspecPath: string) {
    this.cache.delete(pubspecPath);
  }
}
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

### VSCode æ‰©å±•å¼€å‘
- [Extension API](https://code.visualstudio.com/api)
- [Extension Guidelines](https://code.visualstudio.com/api/references/extension-guidelines)
- [Testing Extensions](https://code.visualstudio.com/api/working-with-extensions/testing-extension)

### åŸé¡¹ç›®æºç 
- å‘½åè½¬æ¢: `FlutterAssetsGenerator/src/main/java/com/crzsc/plugin/utils/PluginUtils.kt`
- èµ„æºæ‰«æ: `FlutterAssetsGenerator/src/main/java/com/crzsc/plugin/utils/FileGenerator.kt`
- é…ç½®è¯»å–: `FlutterAssetsGenerator/src/main/java/com/crzsc/plugin/utils/FileHelperNew.kt`

### TypeScript æœ€ä½³å®è·µ
- [TypeScript Deep Dive](https://basarat.gitbook.io/typescript/)
- [Clean Code TypeScript](https://github.com/labs42io/clean-code-typescript)

---

## ğŸ’¡ è´¡çŒ®æŒ‡å—

### æäº¤ä»£ç å‰

1. è¿è¡Œ lint: `npm run lint`
2. è¿è¡Œæµ‹è¯•: `npm test`
3. æ‰‹åŠ¨æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
4. æ›´æ–° CHANGELOG.md

### æäº¤ä¿¡æ¯è§„èŒƒ

ä½¿ç”¨ [Conventional Commits](https://www.conventionalcommits.org/) è§„èŒƒï¼š

```
feat: æ·»åŠ  CodeLens é¢„è§ˆåŠŸèƒ½
fix: ä¿®å¤å‘½åå†²çªå¤„ç†é€»è¾‘
docs: æ›´æ–°å¼€å‘æŒ‡å—
test: æ·»åŠ å‘½åè½¬æ¢å•å…ƒæµ‹è¯•
refactor: é‡æ„é…ç½®è¯»å–é€»è¾‘
perf: ä¼˜åŒ–æ–‡ä»¶æ‰«ææ€§èƒ½
```

---

## ğŸ”„ ç‰ˆæœ¬å‘å¸ƒæµç¨‹

### 1. å‡†å¤‡å‘å¸ƒ
- æ›´æ–°ç‰ˆæœ¬å·ï¼ˆpackage.jsonï¼‰
- æ›´æ–° CHANGELOG.md
- è¿è¡Œæ‰€æœ‰æµ‹è¯•
- æ„å»ºç”Ÿäº§ç‰ˆæœ¬: `npm run vscode:prepublish`

### 2. æ‰“åŒ…
```bash
npm install -g @vscode/vsce
vsce package
```

### 3. å‘å¸ƒ
```bash
vsce publish
```

### 4. å‘å¸ƒå
- åœ¨ GitHub åˆ›å»º Release
- é€šçŸ¥ç”¨æˆ·æ›´æ–°
- æ”¶é›†åé¦ˆ

---

## â“ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•æ·»åŠ æ–°çš„å‘½åé£æ ¼ï¼Ÿ

åœ¨ `src/core/naming.ts` ä¸­æ·»åŠ æ–°æ–¹æ³•ï¼š

```typescript
export class NamingConverter {
  // ç°æœ‰æ–¹æ³•...

  // æ–°å¢å‘½åé£æ ¼
  toUpperSnakeCase(filename: string, pattern: RegExp): string {
    const parts = this.preprocess(filename).split(pattern);
    return parts.map(p => p.toUpperCase()).join('_');
  }
}
```

ç„¶ååœ¨ `src/core/generator.ts` ä¸­ä½¿ç”¨ï¼š

```typescript
switch (config.namingStyle) {
  case 'camelCase':
    return this.naming.toCamelCase(filename, pattern);
  case 'UPPER_SNAKE_CASE':  // æ–°å¢
    return this.naming.toUpperSnakeCase(filename, pattern);
}
```

### Q2: å¦‚ä½•è°ƒè¯•æ–‡ä»¶ç›‘å¬åŠŸèƒ½ï¼Ÿ

åœ¨ `src/utils/logger.ts` ä¸­å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š

```typescript
this.watcher.on('add', (path) => {
  this.logger.debug(`File added: ${path}`);
});
```

### Q3: å¦‚ä½•å¤„ç†å¤§å‹é¡¹ç›®çš„æ€§èƒ½é—®é¢˜ï¼Ÿ

1. ä½¿ç”¨ `path_ignore` æ’é™¤ä¸éœ€è¦çš„ç›®å½•
2. å…³é—­ `auto_detection`ï¼Œæ‰‹åŠ¨è§¦å‘ç”Ÿæˆ
3. ä¼˜åŒ–æ­£åˆ™è¡¨è¾¾å¼æ€§èƒ½
4. è€ƒè™‘ä½¿ç”¨ Worker çº¿ç¨‹å¤„ç†å¤§é‡æ–‡ä»¶

---

**æœ€åæ›´æ–°**: 2025-11-13
