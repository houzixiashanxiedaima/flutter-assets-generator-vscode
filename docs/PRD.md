
# PRD: Flutter Assets Generator for VSCode

## 1. 背景

`FlutterAssetsGenerator` 是一个广受欢迎的 Android Studio/IntelliJ IDEA 插件，它可以帮助 Flutter 开发者自动生成资源的引用文件，从而避免手动输入和维护资源路径，提高了开发效率和代码质量。然而，许多 Flutter 开发者使用 VSCode 作为他们的主要开发工具，但目前缺少一个功能对等、体验优秀的 VSCode 插件。

为了填补这一空白，我们计划将 `FlutterAssetsGenerator` 的核心功能迁移到 VSCode 平台，为广大的 VSCode 用户提供同样便捷的资源管理体验。

## 2. 目标

*   开发一个 VSCode 插件，实现 `FlutterAssetsGenerator` 的核心功能。
*   遵循原插件的资源命名规范，确保迁移后的一致性。
*   提供良好的用户体验，无缝集成到 VSCode 的开发流程中。
*   插件应该易于安装、配置和使用。

## 3. 功能需求

### 3.1. 自动生成资源引用文件

插件的核心功能是自动扫描 `pubspec.yaml` 中定义的资源路径，并生成一个 Dart 文件，其中包含所有资源的静态常量引用。

*   **触发方式**:
    *   用户可以通过命令面板手动触发生成命令。
    *   插件可以监听资源文件的变化（增、删、改），并自动重新生成引用文件。
*   **生成内容**:
    *   生成的 Dart 文件包含一个类，类名可以通过 `pubspec.yaml` 进行配置。
    *   类中为每个资源文件生成一个 `static const String` 类型的常量。
    *   常量的值是资源文件相对于项目根目录的路径。

### 3.2. 资源命名规范

为了与原插件保持一致，并提供更高的灵活性，我们将支持多种命名规范：

*   **常量命名**:
    *   用户可以通过 `naming_style` 配置项选择命名风格，默认为 `camelCase`。
    *   支持的命名风格包括：
        *   `camelCase` (小驼峰式): 例如，`home_icon.png` -> `homeIcon`
        *   `snake_case` (下划线式): 例如，`home_icon.png` -> `home_icon`
        *   `PascalCase` (大驼峰式): 例如，`home_icon.png` -> `HomeIcon`
    *   支持通过正则表达式自定义文件名的分割规则。
*   **可选的父目录命名**:
    *   插件提供一个配置项，允许在常量名中包含父目录的名称，以避免命名冲突。
    *   例如，`assets/images/home_icon.png` 和 `assets/icons/home_icon.png`，如果开启了父目录命名，可以生成 `imagesHomeIcon` 和 `iconsHomeIcon` (以 `camelCase` 为例)。

### 3.3. 配置文件

插件的配置主要通过 `pubspec.yaml` 文件进行，同时支持通过 VSCode 工作区设置进行个性化覆盖。

#### 3.3.1. 项目配置 (`pubspec.yaml`)

这是主要的配置文件，用于团队共享的项目级配置。

```yaml
flutter_assets_generator:
  # 是否在生成的文件中包含 package 前缀
  package_parameter_enabled: false
  # 生成的类名
  class_name: Assets
  # 命名风格 (camelCase, snake_case, PascalCase)
  naming_style: camelCase
  # 是否根据父目录命名
  named_with_parent: true
  # 文件名分割规则
  filename_split_pattern: "[-_]"
  # 忽略的路径
  path_ignore:
    - "assets/images/3.0x/"
```

#### 3.3.2. 工作区覆盖配置 (`.vscode/settings.json`)

为了提供更高的灵活性，允许用户在不修改 `pubspec.yaml` 的情况下，对生成的常量名前缀进行个性化定制。此配置存储在 `.vscode/settings.json` 文件中，可以随工作区共享。

*   **功能**: 允许用户为 `pubspec.yaml` 中定义的每个资源路径指定一个自定义的前缀。
*   **示例**:

    ```json
    // .vscode/settings.json
    {
      "flutter-assets-generator.prefixOverrides": {
        "assets/images/": "image",
        "assets/audio/": "audio"
      }
    }
    ```
*   **生成逻辑**: 
    *   当为 `assets/images/home_icon.png` 生成常量名时，插件会检测到其路径匹配 `assets/images/`。
    *   插件会使用 `image` 作为前缀，而不是默认的 `images`，最终生成 `imageHomeIcon`。

### 3.4. 文件监听

插件应该能够监听资源目录下的文件变化，并在文件发生变化时自动更新生成的 Dart 文件。

*   监听 `pubspec.yaml` 中 `flutter` -> `assets` 字段定义的路径。
*   当资源文件被添加、删除或重命名时，自动触发代码生成。

## 4. 非功能需求

*   **性能**: 插件的运行不应影响 VSCode 的性能，特别是文件监听和代码生成过程。
*   **稳定性**: 插件应运行稳定，不易崩溃，并能正确处理各种异常情况。
*   **易用性**: 插件的安装、配置和使用应尽可能简单直观。
*   **兼容性**: 插件应兼容最新版本的 VSCode 和 Flutter SDK。

## 5. 技术方案

*   **平台**: VSCode Extension
*   **语言**: TypeScript
*   **核心库**:
    *   `vscode` API: 用于与 VSCode 的核心功能进行交互，例如命令面板、文件系统、通知等。
    *   `chokidar` 或类似的库: 用于实现文件系统的监听功能。
    *   `js-yaml`: 用于解析和序列化 `pubspec.yaml` 文件。
*   **实现步骤**:
    1.  **项目初始化**: 使用 `yo code` 创建一个新的 VSCode 插件项目。
    2.  **命令注册**: 在 `package.json` 中注册插件的命令，例如 `flutter-assets-generator.generate`。
    3.  **配置读取**: 实现读取和解析 `pubspec.yaml` 和 `.vscode/settings.json` 中插件配置的逻辑。
    4.  **文件扫描与代码生成**:
        *   实现扫描资源目录、收集资源文件的功能。
        *   根据命名规范和覆盖规则生成 Dart 代码。
        *   将生成的代码写入到指定的文件中。
    5.  **文件监听**: 使用文件系统监听库，监听资源文件的变化，并调用代码生成逻辑。
    6.  **通知与错误处理**: 实现向用户显示通知（如生成成功、失败）和错误处理的逻辑。

## 6. 未来规划

*   **支持更复杂的命名规则**: 提供更灵活的命名规则配置，例如使用正则表达式进行替换。
*   **支持多模块项目**: 更好地支持 Flutter 的多模块项目结构。
*   **提供带实时预览的可视化配置界面**: 
    *   提供一个可视化的界面，让用户更方便地配置插件的行为。
    *   该界面将包含一个“实时预览”区域，当用户修改命名相关的配置时，会立即显示生成的常量名示例，增强交互性和直观性。
*   **可视化界面与 `pubspec.yaml` 的双向同步**: 
    *   可视化界面作为 `pubspec.yaml` 的一个图形化编辑器，当用户在界面上修改配置并保存时，插件会自动更新 `pubspec.yaml` 文件的内容。
    *   反之，当用户直接修改 `pubspec.yaml` 文件时，可视化界面的状态也应随之更新，确保两者始终保持同步。
*   **与其他 Flutter 插件集成**: 探索与其他流行的 Flutter 插件（如 Flutter a-z）集成的可能性。

## 7. 附录：图表

### 7.1. 可视化配置界面 (UI 线框图)

```
+-----------------------------------------------------------------+
| Flutter Assets Generator - 配置                                 |
|-----------------------------------------------------------------|
|                                                                 |
| [项目配置 (pubspec.yaml)]                                       |
|                                                                 |
|   生成的类名: [ Assets           ]                              |
|                                                                 |
|   命名风格:   [ camelCase      ▼ ] (camelCase, snake_case, ...)  |
|                                                                 |
|   [x] 根据父目录命名                                            |
|                                                                 |
|   文件名分割规则: [ /[-_]/         ]                            |
|                                                                 |
|                                                                 |
| [工作区覆盖配置 (.vscode/settings.json)]                        |
|                                                                 |
|   资源路径前缀覆盖:                                             |
|   +--------------------------------+--------------------------+-------+ |
|   | assets/images/                 | [ image (默认: images) ] | [重置] | |
|   | assets/audio/                  | [ audio (默认: audio)  ] | [重置] | |
|   +--------------------------------+--------------------------+-------+ |
|   [ 添加... ]                                                           |
|                                                                 |
|-----------------------------------------------------------------|
|                                                                 |
| [实时预览]                                                      |
|                                                                 |
|   示例资源: assets/images/home_icon.png                         |
|   生成常量: static const String imageHomeIcon = ...;            |
|                                                                 |
|-----------------------------------------------------------------|
|                                           [ 保存 ] [ 重置 ]     |
+-----------------------------------------------------------------+
```

### 7.2. 代码生成流程图

```
                      +----------------------+
                      |   触发 `generate` 命令 |
                      +-----------+----------+
                                  |
                                  v
                      +----------------------+
                      | 读取 `pubspec.yaml`  |
                      |   (项目配置)         |
                      +-----------+----------+
                                  |
                                  v
                      +----------------------+
                      | 读取 `.vscode/       |
                      |   settings.json`     |
                      |   (工作区覆盖配置)   |
                      +-----------+----------+
                                  |
                                  v
                      +----------------------+
                      |   扫描所有资源文件   |
                      +-----------+----------+
                                  |
          +-----------------------+-----------------------+
          |                                               |
          v                                               v
+---------+-----------+                       +-----------+---------+
|  对于每个资源文件   |                       |   (循环结束)        |
+---------+-----------+                       +-----------+---------+
          |                                               ^
          v                                               |
+---------+-----------+                       +-----------+---------+
| 路径是否匹配覆盖规则? | --(否)-->           |  应用默认命名规则   |
+---------+-----------+                       +-----------+---------+
          |                                               |
          | (是)                                          |
          v                                               |
+---------+-----------+                       +-----------+---------+
|   应用自定义前缀    |                       |   生成 Dart 代码行   |
+---------------------+                       +-----------+---------+
          |                                               |
          +-----------------------+-----------------------+
                                  |
                                  v
                      +----------------------+
                      |   将所有代码行写入   |
                      |   到 `.dart` 文件    |
                      +-----------+----------+
                                  |
                                  v
                      +----------------------+
                      |         结束         |
                      +----------------------+
```
